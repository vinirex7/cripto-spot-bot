# API Keys Configuration (fallback to environment variables if empty)
api_keys:
  binance:
    api_key: ""  # Se vazio, usa BINANCE_API_KEY env var
    api_secret: ""  # Se vazio, usa BINANCE_API_SECRET env var

  cryptopanic:
    token: ""  # Se vazio, usa CRYPTOPANIC_TOKEN env var

  openai:
    api_key: ""  # Se vazio, usa OPENAI_API_KEY env var
    model: "gpt-4o-mini"  # Se vazio, usa OPENAI_MODEL env var ou default

bot:
  name: "Vini-Cripto-Spot-Bot"
  log_dir: "./logs"

# Execution mode configuration
execution:
  mode: "paper"  # paper | trade
  decision_every_minutes: 15
  loop_seconds: 60
  timezone: "UTC"

  paper:
    initial_balance_usdt: 10000
    enable_slippage: true
    slippage_bps: 5

  trade:
    dry_run: false  # Se true, simula mas não envia ordens
    max_order_value_usdt: 1000  # Limite por ordem em modo trade

# Exchange configuration
exchange:
  name: "binance"
  base_url: "https://api.binance.com"
  testnet_url: "https://testnet.binance.vision"  # Para testes
  use_testnet: false
  recv_window: 5000
  timeout_seconds: 30

  orders:
    default_type: "LIMIT"  # LIMIT | MARKET
    limit_ttl_seconds: 30
    price_offset_bps: 5  # Basis points offset para limit orders
    max_spread_bps: 10  # Max spread aceitável
    min_notional_usdt: 10  # Mínimo por ordem

universe:
  - BTCUSDT
  - ETHUSDT
  - BNBUSDT
  - SOLUSDT
  - LINKUSDT
  - AVAXUSDT
  - ADAUSDT

positioning:
  max_positions: 2
  weight_per_position: 0.30
  cash_buffer: 0.40

# -----------------------------
# MOMENTUM (Melhorado)
# -----------------------------
momentum:
  # Mantém teus parâmetros atuais (compatibilidade com código legado)
  n_days_short: 182
  n_days_long: 365
  min_momentum_idade: 0
  require_delta_positive: true
  age_days_buckets:
    - {max_days: 365, factor: 1.00}
    - {max_days: 456, factor: 0.75}
    - {max_days: 547, factor: 0.50}
    - {max_days: 9999, factor: 0.25}

  # ---- Novos campos usados pelo compute_momentum_features() melhorado ----
  interval_1d: "1d"

  # Importante: no código atual isso é BAR COUNT via LIMIT (não "dias de calendário")
  lookback_6m_days: 182
  lookback_12m_days: 365

  # +60 candles extras para medir "quando o momentum virou positivo"
  age_extra_bars: 60

  # Mínimos de pontos exigidos para considerar cálculo confiável
  min_points: 120
  min_points_6m: 120
  min_points_12m: 240

  # Clamp do sigma para evitar "explosão" quando volatilidade ~ 0
  min_sigma: 1e-12

  # Gate opcional: exigir também m12 > 0 (deixe false por padrão)
  require_m12_positive: false

  # Como você exige delta positivo, threshold em 0.0 resolve (delta_m > 0)
  delta_threshold: 0.0

# Legacy momentum (dual-period) parameters kept for compatibility
momentum2:
  n_days_short: 180
  n_days_long: 365

# -----------------------------
# NEWS (Atualizado para LLM + TTL/Decay + CryptoPanic v2)
# -----------------------------
news:
  # --- NOVO (usado pelo news/engine.py) ---
  lookback_hours: 12

  # thresholds em escala [-1, 1] (LLM)
  llm_hard_threshold: -0.6
  llm_soft_threshold: -0.3

  # cache/decay do LLM
  analysis_cache_ttl_minutes: 180
  decay_half_life_minutes: 180

  # --- LEGADO (mantido para não quebrar outros módulos que ainda leiam isso) ---
  sentz_hard: -3.0
  priceshockz_hard: -3.0
  ns_hard: -2.5
  ns_soft: -1.5
  volspike_soft: 1.5
  volspike_hard: 1.8
  cooldown_hours_hard: 6

  cryptopanic:
    enabled: true
    request_timeout_s: 10

    # NOVO (pedido): hot + limit 50
    filter: "hot"
    limit: 50

    # (informativo) endpoint v2 é usado no código:
    # https://cryptopanic.com/api/developer/v2/posts/?auth_token=...

  openai:
    enabled: true
    request_timeout_s: 25

    # opcional: tuning do Responses API
    temperature: 0.2
    max_output_tokens: 250

microstructure:
  ofi_z_entry: 2.0
  ofi_z_risk_on: 1.5
  fallback_volume: 1.0

risk:
  target_vol_1d: 0.012
  max_positions: 2
  weight_per_position: 0.30
  cash_buffer: 0.40
  daily_drawdown_pause: 0.025
  max_holding_hours: 72
  illiq_size_discount: 0.5

sentiment:
  enabled: true
  provider: "cryptopanic"
  decay_half_life_hours: 12
  trusted_sources:
    - coindesk
    - cointelegraph
    - reuters
    - bloomberg

economy_rules:
  horizon_minutes: 60
  ewma_alpha: 0.08
  min_snr: 0.20
  min_pwin: 0.55
  require_ev_positive: true

adaptive:
  enabled: true
  recalibrate_every_minutes: 60
  lr: 0.10
  ridge_lambda: 5.0
  max_train_rows: 2000
  min_train_rows: 200

short_term_rules:
  shock_filter:
    enabled: true
    z_threshold_1h: 3.0
    cooldown_hours: 6

storage:
  sqlite_path: "./bot.db"

# Logging configuration
logging:
  flush_every_write: true
  files:
    decisions: "logs/decisions.jsonl"
    trades: "logs/trades.jsonl"
